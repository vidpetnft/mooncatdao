<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <link rel="icon" href="img/icon.png">
    <title>ALLCATS</title>
    <style>
      html, body {
        margin: 0;
        padding: 0;
        background: #000;
        width: 100%;
        height: 100%;
        overflow: hidden;
      }

      #viewport {
        width: 100%;
        height: 100%;
        overflow: auto;
        background: #000;
        overscroll-behavior: none;
      }

      #stage {
        position: relative;
        background: #000;
      }

      #img {
        position: absolute;
        left: 0;
        top: 0;
        transform-origin: 0 0;

        image-rendering: pixelated;
        image-rendering: crisp-edges;
        -ms-interpolation-mode: nearest-neighbor;

        user-select: none;
        -webkit-user-drag: none;
        cursor: default;
      }
    </style>
  </head>
  <body>
    <div id="viewport">
      <div id="stage">
        <img id="img" src="img/allcats.png" alt="ALLCATS" />
      </div>
    </div>

    <script>
      const viewport = document.getElementById("viewport");
      const stage = document.getElementById("stage");
      const img = document.getElementById("img");

      let scale = 1;

      const MIN_SCALE = 0.25;

      const MAX_SCALE = 200;

      const PAD = 200;

      let imgW = 0;
      let imgH = 0;

      function clamp(v, min, max) {
        return Math.min(Math.max(v, min), max);
      }

      function applyTransform() {
        img.style.transform = `scale(${scale})`;
      }

      function updateStageSizeAndPosition() {
        img.style.left = PAD + "px";
        img.style.top = PAD + "px";

        const contentW = Math.ceil(imgW * scale + PAD * 2);
        const contentH = Math.ceil(imgH * scale + PAD * 2);

        const minW = viewport.clientWidth;
        const minH = viewport.clientHeight;

        stage.style.width = Math.max(contentW, minW) + "px";
        stage.style.height = Math.max(contentH, minH) + "px";
      }

      function centerInitialView() {
        viewport.scrollLeft = Math.max(0, PAD - 50);
        viewport.scrollTop = Math.max(0, PAD - 50);
      }

      function zoomAt(clientX, clientY, zoomFactor) {
        const rect = viewport.getBoundingClientRect();
        const mouseX = clientX - rect.left;
        const mouseY = clientY - rect.top;

        const scrollLeft = viewport.scrollLeft;
        const scrollTop = viewport.scrollTop;

        const stageX = scrollLeft + mouseX;
        const stageY = scrollTop + mouseY;

        const imgLeft = PAD;
        const imgTop = PAD;

        const relX = (stageX - imgLeft) / scale;
        const relY = (stageY - imgTop) / scale;

        const newScale = clamp(scale * zoomFactor, MIN_SCALE, MAX_SCALE);
        if (newScale === scale) return;

        scale = newScale;

        applyTransform();
        updateStageSizeAndPosition();

        const newStageX = imgLeft + relX * scale;
        const newStageY = imgTop + relY * scale;

        viewport.scrollLeft = newStageX - mouseX;
        viewport.scrollTop = newStageY - mouseY;
      }

      function handleResize() {
        updateStageSizeAndPosition();
      }

      img.onload = () => {
        imgW = img.naturalWidth;
        imgH = img.naturalHeight;

        scale = clamp(scale, MIN_SCALE, MAX_SCALE);

        applyTransform();
        updateStageSizeAndPosition();
        centerInitialView();
      };

      window.addEventListener("resize", handleResize);

      viewport.addEventListener("wheel", (e) => {
        const wantsZoom = e.ctrlKey || e.metaKey;
        if (!wantsZoom) return;

        e.preventDefault();

        const zoomIn = e.deltaY < 0;
        const factor = zoomIn ? 1.12 : 1 / 1.12;

        zoomAt(e.clientX, e.clientY, factor);
      }, { passive: false });
    </script>
  </body>
</html>
