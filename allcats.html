<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <link rel="icon" href="img/icon.png">
    <title>ALLCATS</title>
    <style>
      html, body {
        margin: 0;
        padding: 0;
        background: #000;
        width: 100%;
        height: 100%;
        overflow: hidden;
      }

      #viewport {
        width: 100%;
        height: 100%;
        overflow: auto;
        background: #000;

        touch-action: none;
        overscroll-behavior: none;
      }

      #stage {
        position: relative;
        width: 50000px;
        height: 50000px;
        background: #000;
      }

      #img {
        position: absolute;
        left: 1000px;
        top: 1000px;
        transform-origin: 0 0;

        image-rendering: pixelated;
        image-rendering: crisp-edges;
        -ms-interpolation-mode: nearest-neighbor;

        user-select: none;
        -webkit-user-drag: none;
      }
    </style>
  </head>
  <body>
    <div id="viewport">
      <div id="stage">
        <img id="img" src="img/allcats.png" alt="ALLCATS">
      </div>
    </div>

    <script>
      const viewport = document.getElementById("viewport");
      const img = document.getElementById("img");

      let scale = 1;
      const MIN_SCALE = 0.05;
      const MAX_SCALE = 300;

      function clamp(v, min, max) {
        return Math.min(Math.max(v, min), max);
      }

      function applyScale() {
        img.style.transform = `scale(${scale})`;
      }

      function zoomAt(clientX, clientY, zoomFactor) {
        const rect = viewport.getBoundingClientRect();
        const mouseX = clientX - rect.left;
        const mouseY = clientY - rect.top;

        const stageX = viewport.scrollLeft + mouseX;
        const stageY = viewport.scrollTop + mouseY;

        const imgLeft = parseFloat(img.style.left || "0");
        const imgTop = parseFloat(img.style.top || "0");

        const relX = (stageX - imgLeft) / scale;
        const relY = (stageY - imgTop) / scale;

        const newScale = clamp(scale * zoomFactor, MIN_SCALE, MAX_SCALE);
        if (newScale === scale) return;

        scale = newScale;
        applyScale();

        const newStageX = imgLeft + relX * scale;
        const newStageY = imgTop + relY * scale;

        viewport.scrollLeft = newStageX - mouseX;
        viewport.scrollTop = newStageY - mouseY;
      }

      img.onload = () => {
        applyScale();
        viewport.scrollLeft = 950;
        viewport.scrollTop = 950;
      };

      window.addEventListener("wheel", (e) => {
        const inside = viewport.contains(e.target);
        if (!inside) return;

        e.preventDefault();

        const zoomIn = e.deltaY < 0;
        const factor = zoomIn ? 1.12 : 1 / 1.12;

        zoomAt(e.clientX, e.clientY, factor);
      }, { passive: false, capture: true });

      window.addEventListener("gesturestart", (e) => {
        const inside = viewport.contains(e.target);
        if (!inside) return;
        e.preventDefault();
      }, { passive: false, capture: true });

      window.addEventListener("gesturechange", (e) => {
        const inside = viewport.contains(e.target);
        if (!inside) return;

        e.preventDefault();

        const factor = e.scale > 1 ? 1.06 : 1 / 1.06;
        zoomAt(e.clientX, e.clientY, factor);
      }, { passive: false, capture: true });
    </script>
  </body>
</html>
